var clientId="",defaultChecklistArray=[],typeChecklistArray=["Agrupamento","Texto","Upload","Multiplas Escolhas","Dupla Escolha","Numerica","Data","Agrupamento (dupla escolha)","Maior/Igual Que","Menor/Igual Que"],idIncrement=0,allCloneChecklistGrouping=[],checklistText=ONE_ELEMENT(".checklist"),checklistMultipleChoice=ONE_ELEMENT(".checklistMultiple"),checklistOption=ONE_ELEMENT(".checklistOption"),checklistJson=ONE_ELEMENT("#checklistArrayJson").value;function verifyInProgressChecklist(){""!=checklistJson&&(idIncrement=parseInt(ONE_ELEMENT("#lastIdIncrement").value),defaultChecklistArray=JSON.parse(ONE_ELEMENT("#checklistArrayJson").value),allCloneChecklistGrouping=JSON.parse(ONE_ELEMENT("#groupingArrayJson").value),clientId=ONE_ELEMENT("#idClientToJson").value,ONE_ELEMENT("#idClient").value=clientId,ONE_ELEMENT("#cardContentChecklist").style.display="flex",fillChecklistInfo(defaultChecklistArray),verifyBtnScroll())}async function requestDefaultChecklist(e){const t=await fetch(BASE_URL+"/get_default_checklist_request/"+e),i=await t.json();ONE_ELEMENT("#card-loading").style.display="none",ONE_ELEMENT("#cardContentChecklist").style.display="flex",fillChecklistInfo(i),verifyBtnScroll()}function fillChecklistInfo(e){idIncrement=filterDefaultChecklistLastId((defaultChecklistArray=e).subchecklist),fillChecklistMasterLayout(),fillChecklistsLayout(defaultChecklistArray.subchecklist),fillValuesToChecklist(defaultChecklistArray.subchecklist),eventsChecklists(),updateChecklistPoint()}function fillChecklistMasterLayout(){let e=ONE_ELEMENT("#cardContentChecklist");e.querySelector("#contentChecklist").innerHTML="",e.querySelector(".defaultChecklist__name").innerHTML="Nome Checklist: "+defaultChecklistArray.name,e.querySelector(".defaultChecklist__points").innerHTML="Pontuação Total: "+defaultChecklistArray.points.toFixed(2),e.querySelector(".defaultChecklist__possiblePoints").innerHTML="Pontuação Obtida: "+defaultChecklistArray.pointsObtained.toFixed(2),e.querySelector(".defaultChecklist__observation").innerHTML="Observação : \n        "+(""!==defaultChecklistArray.observation?defaultChecklistArray.observation:"Não Informado")}verifyInProgressChecklist(),[...ALL_ELEMENTS(".defaultCheckRadio")].forEach(e=>{e.addEventListener("change",e=>{let t=e.currentTarget.value;ONE_ELEMENT("#idDefaultChecklist").value=t,ONE_ELEMENT("#cardContentChecklist").style.display="none",LOADING_ELEMENT.style.display="flex",ONE_ELEMENT("#card-loading").append(LOADING_ELEMENT),ONE_ELEMENT("#card-loading").style.display="flex",requestDefaultChecklist(t)})}),[...ALL_ELEMENTS(".clientRadio")].forEach(e=>{e.addEventListener("change",e=>{clientId=e.currentTarget.value,ONE_ELEMENT("#idClient").value=clientId,ONE_ELEMENT("#idClientToJson").value=clientId})}),ONE_ELEMENT(".btnScrollToBotttom").addEventListener("click",()=>{let e=ONE_ELEMENT("#btnSave").getBoundingClientRect();window.scrollBy(e.x,e.y)});const LOW=1,MIDDLE=2,HIGH=3;function updateChecklistPoint(){let e=defaultChecklistArray.points.toFixed(2),t=defaultChecklistArray.pointsObtained.toFixed(2);checklistPointsLayout(e,t),updateLayoutSituation(e/3,t)}function checklistPointsLayout(e,t){ONE_ELEMENT(".checklists__point").style.display="flex",ONE_ELEMENT(".checklist__pointTotal").innerHTML=e,ONE_ELEMENT(".checklist__pointObtained").innerHTML=t}function updateLayoutSituation(e,t){let i=verifySituationPointsClient(e,t),n=ALL_ELEMENTS(".checklists__point-slot")[1];clearLayoutSituation(),1===i?n.classList.add("low"):2===i?n.classList.add("middle"):n.classList.add("high")}function verifyBtnScroll(){ONE_ELEMENT(".actionsScroll").style.display=defaultChecklistArray!==[]?"flex":"none"}function clearLayoutSituation(){let e=ALL_ELEMENTS(".checklists__point-slot")[1];e.classList.remove("low"),e.classList.remove("middle"),e.classList.remove("high")}function verifySituationPointsClient(e,t){let i=2*e;return t>=0&&t<i?1:t>=i&&t<3*e?2:3}function fillChecklistsLayout(e,t=null){e.forEach(e=>{appendChecklist(e,t),appendSubchecklist(e)})}function appendChecklist(e,t){null===t?ONE_ELEMENT("#contentChecklist").append(returnElementChecklist(e)):t.querySelector(".checklist__container").append(returnElementChecklist(e))}function appendSubchecklist(e){if(e.subchecklist.length>0){let t=ONE_ELEMENT("#checklist"+e.id);fillChecklistsLayout(e.subchecklist,t)}}function fillLayoutChecklist(e,t){showAndIdentifyChecklistElement(e,t),hideSlotChecklistSlotAgroping(t,e),layoutChecklistAgropingDuplicate(e,t),showHeaderBtnsDuplicateSubchecklistLayout(e,t),setTitleToChecklist(t,e),verifyOnlyOnePointsLayout(e,t),setInfoToChecklist(e,t),setObservationChecklist(e,t)}function showAndIdentifyChecklistElement(e,t){e.style.display="flex",e.setAttribute("idchecklist",t.id),e.setAttribute("id","checklist"+t.id)}function hideSlotChecklistSlotAgroping(e,t){0!==e.id_type_checklist&&7!==e.id_type_checklist||(t.querySelectorAll(".checklist__slot")[0].style.display="none")}function setTitleToChecklist(e,t){3===e.id_type_checklist||4===e.id_type_checklist?(t.querySelector(".checklistTitleSlot").innerHTML=e.name,t.querySelector(".checklistTitleSlot").setAttribute("title",e.name)):(t.querySelector(".checklist__title").innerHTML=e.name,t.querySelector(".checklist__title").setAttribute("title",e.name))}function verifyOnlyOnePointsLayout(e,t){(t.only_one_choose_points||t.only_one_choose)&&(e.querySelector(".checklistTypechecklist").style="flex:2;")}function setInfoToChecklist(e,t){let i="";8!==t.id_type_checklist&&9!==t.id_type_checklist||(i=" "+t.big_smaller),e.querySelector(".checklistTypechecklist").innerHTML=`${typeChecklistArray[t.id_type_checklist]}${i}`,e.querySelector(".checklistTypechecklist").setAttribute("title",""+typeChecklistArray[t.id_type_checklist]),e.querySelector(".checklistPossiblePoints").innerHTML="Pontos: "+t.points.toFixed(2),e.querySelector(".checklistPossiblePoints").setAttribute("title",t.points),e.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+t.pointsObtained.toFixed(2),e.querySelector(".checklistPoints").setAttribute("title",t.pointsObtained)}function setObservationChecklist(e,t){""!==t.observation&&(3!==t.id_type_checklist&&4!==t.id_type_checklist?(e.querySelector(".observationIcon").style.display="block",e.querySelector(".observationIcon").setAttribute("title",t.observation)):(e.querySelector(".observationIconMultiple").style.display="block",e.querySelector(".observationIconMultiple").setAttribute("title",t.observation)))}function showHeaderBtnsDuplicateSubchecklistLayout(e,t){t.duplicateSubchecklist&&(e.querySelector(".checklist__header--optionsContainer").style.display="none",e.querySelector(".checklist__header__actions").style.display="flex",e.querySelector(".checklist__header__actions .btnDelete").classList.remove("d-none"))}function layoutChecklistAgropingDuplicate(e,t){if(7===t.id_type_checklist){showHeaderActionsToAgroupingDuplicate(e);let i=getAndSetAtributeInputsRadiosToAgroupingDuplicate(e,t);verifyThereIsChecklistInAgroupingArray(t)?(i[0].checked=!0,showBtnsAndQuantityToAgroupingDuplicate(e,t)):(i[1].checked=!0,removeBtnsAndQuantityToAgroupingDuplicate(e)),t.duplicate||0!==t.pointsObtained&&(i[0].checked=!0,itsNotDuplicateChecklistAgroupingLayout(e)),0===t.subchecklist.length&&(i[1].checked=!0,thereNotSubchecklistInAgroupingLayout(e))}}function showHeaderActionsToAgroupingDuplicate(e){e.querySelector(".checklist__header__actions").style.display="flex"}function getAndSetAtributeInputsRadiosToAgroupingDuplicate(e,t){let i=e.querySelectorAll(".checkGroupingChoice");return i[0].setAttribute("name","checkGroupingChoice"+t.id),i[1].setAttribute("name","checkGroupingChoice"+t.id),i}function showBtnsAndQuantityToAgroupingDuplicate(e,t){e.querySelectorAll(".checklist__header__slot")[2].classList.remove("d-none"),e.querySelector(".checklist__header__quantity").previousElementSibling.style.display="block",e.querySelector(".checklist__header__quantity").innerHTML=t.subchecklist.length,e.querySelector(".checklist__header .btnAdd").classList.remove("d-none")}function removeBtnsAndQuantityToAgroupingDuplicate(e){e.style.height="120px",e.querySelectorAll(".checklist__header__slot")[2].classList.add("d-none")}function itsNotDuplicateChecklistAgroupingLayout(e){e.style.height="auto",e.querySelector(".checklist__header__quantity").previousElementSibling.style.display="none",e.querySelector(".checklist__header__quantity").style.display="none",e.querySelectorAll(".checklist__header__slot")[2].classList.remove("d-none")}function thereNotSubchecklistInAgroupingLayout(e){e.style.height="120px",e.querySelectorAll(".checklist__header__slot")[2].classList.add("d-none")}function fillValuesToChecklist(e){e.forEach(e=>{let t=ONE_ELEMENT("#checklist"+e.id),i=parseInt(e.id_type_checklist);fillInputOrOptionsValue(i,t,e),setObservationChecklistValue(t,e),setUploadChecklistValues(i,e,t),t.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+e.pointsObtained.toFixed(2),headerLayoutInChecklistValues(e,t),7===e.id_type_checklist&&(groupingDoubleChoiceChecklistLayout(t,e),duplicateSubchecklistHeaderAndActions(t,e),layoutValuesChecklistWithoutSubchecklist(t,e)),e.duplicate&&layoutHeighChecklist(t,e),e.subchecklist.length>0&&fillValuesToChecklist(e.subchecklist)})}function fillInputOrOptionsValue(e,t,i){if(3!==e&&2!==e&&4!==e&&0!==e&&7!==e){getInputToChecklist(e,t).value=i.value}else checklistOptionsValues(i,t)}function getInputToChecklist(e,t){let i=null;return 1===e?i=t.querySelector(".inputText"):2===e?i=t.querySelector(".inputFile"):5===e||8===e||9===e?i=t.querySelector(".inputNumber"):6===e&&(i=t.querySelector(".inputDate")),i}function returnElementChecklist(e){let t=e.id_type_checklist,i="";return i=3!==t&&4!==t?elementInputsChecklist(e,t):elementMultipleChoiceChecklist(e,t),i}function checklistOptionsValues(e,t){e.options.forEach(e=>{e.selected&&(t.querySelector(".option"+e.id).checked=!0)})}function setObservationChecklistValue(e,t){e.querySelector(".inputObservation").value=t.oficialObservation}function setUploadChecklistValues(e,t,i){if(2===e&&""!==t.value){let e=i.querySelector(".checklist__title").innerHTML,n=t.value.split(",").length;i.querySelector(".checklist__title").innerHTML=`${e}: ${n} arquivo/s selecionado/s`}}function headerLayoutInChecklistValues(e,t){e.duplicate&&7!==e.id_type_checklist&&(t.querySelector(".checklist__header__actions").style.display="flex",t.querySelector(".checklist__header--optionsContainer").style.display="none",t.querySelector(".checklist__header .btnAdd").classList.remove("d-none"))}function groupingDoubleChoiceChecklistLayout(e,t){let i=e.querySelectorAll("input[name=checkGroupingChoice"+t.id);t.groupingDoubleChoice&&(i[0].checked=!0,e.style.height="auto")}function layoutValuesChecklistWithoutSubchecklist(e,t){let i=e.querySelectorAll("input[name=checkGroupingChoice"+t.id);0===t.subchecklist.length&&(i[1].checked=!0,e.style.height="120px",e.querySelectorAll(".checklist__header__slot")[2].classList.add("d-none"),e.querySelector(".checklist__header .btnAdd").classList.add("d-none"))}function duplicateSubchecklistHeaderAndActions(e,t){let i=e.querySelectorAll("input[name=checkGroupingChoice"+t.id);verifyThereIsChecklistInAgroupingArray(t)&&t.duplicate&&(i[0].checked=!0,t.subchecklist.forEach(e=>{ONE_ELEMENT("#checklist"+e.id).querySelector(".checklist__header__actions").style.display="flex",ONE_ELEMENT("#checklist"+e.id).querySelector(".checklist__header--optionsContainer").style.display="none",ONE_ELEMENT("#checklist"+e.id).querySelector(".btnDelete").classList.remove("d-none")}))}function layoutHeighChecklist(e,t){verifyThereIsChecklistInAgroupingArray(t)?e.style.height="auto":e.style.height="120px"}function elementInputsChecklist(e,t){let i=checklistText.cloneNode(!0);return getOrShowInputByType(i,t),fillLayoutChecklist(i,e),i}function getOrShowInputByType(e,t,i=!0){let n="";if(1===t?n=e.querySelector(".inputText"):2===t?n=e.querySelector(".inputFile"):5===t||8===t||9===t?n=e.querySelector(".inputNumber"):6===t&&(n=e.querySelector(".inputDate")),0!==t&&7!==t){if(!i)return n;n.style.display="flex"}}function elementMultipleChoiceChecklist(e){let t=checklistMultipleChoice.cloneNode(!0);return fillLayoutChecklist(t,e),fillLayoutOptions(e,t),t}function verifyThereIsChecklistInAgroupingArray(e){return-1!==allCloneChecklistGrouping.findIndex(t=>{if(t.id===e.idReferenceClone)return!0})}function fillLayoutOptions(e,t){e.options.forEach(i=>{let n=checklistOption.cloneNode(!0);0===i.pointsObtained&&(i.pointsObtained=0),layoutChecklistOptions(e,n,i),n.style.display="flex",n.setAttribute("idoption",i.id),n.querySelector(".optionName").innerHTML=i.name,n.querySelector(".checklistPoints").innerHTML="Pontos: "+i.points.toFixed(2),t.querySelector(".checklist__options").append(n)})}function layoutChecklistOptions(e,t,i){if(3===e.id_type_checklist){let n=getChecklistOptionElement(e,t);n.style.display="flex",n.setAttribute("name","option"+e.id),n.classList.add("option"+i.id)}else t.querySelector(".checklistOptionRadio").style.display="flex",t.querySelector(".checklistOptionRadio").setAttribute("name","option"+e.id),t.querySelector(".checklistOptionRadio").classList.add("option"+i.id)}function getChecklistOptionElement(e,t){let i=null;return i=e.only_one_choose?t.querySelector(".checklistOptionRadio"):t.querySelector(".checklistOptionCheck"),e.distinct_percentage&&(i=t.querySelector(".checklistOptionRadio")),i}function eventsChecklists(){[...ALL_ELEMENTS("#contentChecklist .checklist")].forEach(e=>{let t=parseInt(e.getAttribute("idchecklist")),i=filterChecklist(defaultChecklistArray.subchecklist,t,{}),n=i.id_type_checklist;0!==n&&7!==n&&3!==n&&4!==n?eventsChecklistsTypeInputs(e,i):0!==n&&7!==n&&eventsChecklistsMultipleOptions(e,i,verifyIfIsMultipleChecklistToEvent(n)),i.duplicate?(eventsDoubleChoiceGroupingDuplicate(e,i),eventsDoubleAddChoiceGrouping(e,i)):eventsDoubleChoiceGrouping(e,i),eventsObservationInput(e,i),eventsDoubleDeleteChoiceGrouping(e,i)})}function eventsChecklistsTypeInputs(e,t){let i=t.id_type_checklist,n=getOrShowInputByType(e,i,!1);2===i?eventUploadEvent(n,t,e):eventNormalInputs(n,t,e)}function eventNormalInputs(e,t,i){e.addEventListener("input",e=>{let n=t.points,l=e.currentTarget.value;t.value=l;let s=!1,c=!1;8===t.id_type_checklist||9===t.id_type_checklist?c=verifyBigSmaller(t,l):s=verifyEmptyInput(l),8===t.id_type_checklist||9===t.id_type_checklist?c?0===t.pointsObtained&&(t.pointsObtained=n,updatePointsFatherChecklist(t,n,!0)):t.pointsObtained>0&&(t.pointsObtained=0,updatePointsFatherChecklist(t,n,!1)):(s&&0===t.pointsObtained&&(t.pointsObtained=n,updatePointsFatherChecklist(t,n,s)),!1===s&&t.pointsObtained>0&&(t.pointsObtained=0,updatePointsFatherChecklist(t,n,s))),i.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+t.pointsObtained.toFixed(2)})}function verifyEmptyInput(e){let t=!0;return""===e&&(t=!1),t}function verifyBigSmaller(e,t){let i=!0,n=e.big_smaller;return""===t&&(i=!1),8===e.id_type_checklist&&t<n&&(i=!1),9===e.id_type_checklist&&t>n&&(i=!1),i}function eventUploadEvent(e,t,i){e.addEventListener("change",e=>{let n=t.points,l=e.currentTarget.files;alertToUploadFiles(i,!1),getSizeFiles(l)<4e7?uploadFile(l,t):alertToUploadFiles(i),t.pointsObtained=n,i.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+t.pointsObtained.toFixed(2),""===t.value&&updatePointsFatherChecklist(t,n)})}function getSizeFiles(e){let t=0;return[...e].forEach(e=>{t+=e.size}),t}function alertToUploadFiles(e,t=!0){t?(e.querySelector(".alert").classList.remove("d-none"),e.querySelector(".alert").innerHTML="O arquivo tem que ser menor que 40mb"):e.querySelector(".alert").classList.add("d-none")}function eventsObservationInput(e,t){e.querySelector(".inputObservation").addEventListener("keyup",e=>{let i=e.currentTarget.value;t.oficialObservation=i})}async function uploadFile(e,t){let i=ONE_ELEMENT("#uploadFileForm");const n=new FormData(i);[...e].forEach(e=>{n.append("checklistFile[]",e)});const l=await fetch(BASE_URL+"/upload_file",{method:"POST",body:n});let s=(await l.json()).filesNames;t.value=s.join(","),t.files=e}function eventsChecklistsMultipleOptions(e,t,i=!0){[...e.querySelectorAll(".checklistOption")].forEach(n=>{let l=parseInt(n.getAttribute("idoption"));getTypeOption(i,t.only_one_choose,t.distinct_percentage,n).addEventListener("change",n=>{let s=getIndexToOption(t,l),c=t.options[s],o=c.points,r=t.pointsObtained;n.currentTarget.checked?eventOptionIsChecked(t,c,o,r,i,e):eventOptionIsNotChecked(t,c,o,r,i,e)})})}function getTypeOption(e,t,i,n){let l=null;return l=!1===e||t||i?n.querySelector("input[type=radio]"):n.querySelector("input[type=checkbox]"),l}function eventOptionIsChecked(e,t,i,n,l,s){let c=e.pointsObtained;e.pointsObtained=n+i,setZeroInOptions(e),t.selected=!0,t.pointsObtained=i;let o=getTotalCountSelectedOnlyOneChoose(e),r=!0;setSelectedFalseWhenIsOnlyOneChoose(o,e,t),setSelectedFalseWhenIsDoubleChoose(e,t),0===i&&(r=!1,!1!==e.distinct_percentage&&null!==e.distinct_percentage||(i=e.points)),samePointToOnlyOneChecklist(e,i),updatePointsFatherChecklist(e,i=setSelectedFalseWhenIsOnlyOneChooseAndZeroPoints(e,o,t,i=zeroPointsOptions(e,l,r,o,i),c),r),s.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+e.pointsObtained.toFixed(2)}function getIndexToOption(e,t){return e.options.findIndex(e=>{if(e.id===t)return!0})}function setZeroInOptions(e){(e.only_one_choose||e.only_one_choose_points||e.distinct_percentage)&&e.options.forEach(e=>{e.pointsObtained=0})}function getTotalCountSelectedOnlyOneChoose(e){let t=0;return e.options.forEach(e=>{e.selected&&t++}),t}function samePointToOnlyOneChecklist(e,t){(e.only_one_choose||e.only_one_choose_points||e.distinct_percentage)&&(e.pointsObtained=t)}function setSelectedFalseWhenIsDoubleChoose(e,t){4===e.id_type_checklist&&(e.options.forEach(e=>{e.selected=!1}),t.selected=!0)}function setSelectedFalseWhenIsOnlyOneChoose(e,t,i){e>2&&t.only_one_choose&&(t.options.forEach(e=>{e.selected=!1}),i.selected=!0)}function setSelectedFalseWhenIsOnlyOneChooseAndZeroPoints(e,t,i,n,l=0){let s=n;return e.only_one_choose&&t>1&&(s=0,e.options.forEach(e=>{e.selected=!1}),i.selected=!0),t>1&&e.only_one_choose_points&&(s=0),e.distinct_percentage&&t>1&&(updatePointsFatherChecklist(e,l,!1),s=e.pointsObtained,e.options.forEach(e=>{e.selected=!1}),i.selected=!0),s}function zeroPointsOptions(e,t,i,n,l){return!1===t&&(e.pointsObtained=l,!1===i&&(e.pointsObtained=0,1===n&&(l=0))),l}function eventOptionIsNotChecked(e,t,i,n,l,s){if(e.pointsObtained=n-i,t.selected=!1,!1===l&&(e.pointsObtained=i),e.only_one_choose||e.only_one_choose_points){setOptionsValues(getOptionsCount(e),e,i,s)}else updateOptionsPoints(e,0,s)}function getOptionsCount(e){let t=0;return e.options.forEach(e=>{e.selected&&t++}),t}function setOptionsValues(e,t,i,n){0===e||e>0&&t.only_one_choose_points&&(t.pointsObtained=i,i=0),updateOptionsPoints(t,i,n)}function updateOptionsPoints(e,t,i){updatePointsFatherChecklist(e,t,!1),i.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+e.pointsObtained.toFixed(2)}function updatePointsFatherChecklist(e,t,i=!0){let n=e.idDefaultChecklist;if(n===defaultChecklistArray.id){updateLayoutChecklistMaster(updatePointsChecklistMaster(defaultChecklistArray.subchecklist,0))}else{let e=filterChecklist(defaultChecklistArray.subchecklist,n,{});null!==e&&(i&&(e.pointsObtained+=t),!1===i&&e.pointsObtained>0&&(e.pointsObtained-=t),updateLayoutChecklist(e),null!==e.idDefaultChecklist&&updatePointsFatherChecklist(e,t,i)),updateLayoutChecklistMaster(updatePointsChecklistMaster(defaultChecklistArray.subchecklist,0))}}function updatePointsChecklistMaster(e,t=0){let i=t;return e.forEach(e=>{e.idDefaultChecklist===defaultChecklistArray.id&&(i+=e.pointsObtained,e.subchecklist.length>0&&(i=updatePointsChecklistMaster(e.subchecklist,i)))}),i}function updateLayoutChecklistMaster(e){defaultChecklistArray.pointsObtained=e,ONE_ELEMENT("#cardContentChecklist").querySelector(".defaultChecklist__possiblePoints").innerHTML="Pontuação Obtida: "+defaultChecklistArray.pointsObtained.toFixed(2),updateChecklistPoint()}function updateLayoutChecklist(e){ONE_ELEMENT("#checklist"+e.id).querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+e.pointsObtained.toFixed(2)}function verifyIfIsMultipleChecklistToEvent(e){let t=!1;return 3===e&&(t=!0),t}function eventsDoubleChoiceGroupingDuplicate(e,t){[...e.querySelector(".checklist__header__actions").querySelectorAll(".checkGroupingChoice")].forEach(i=>{i.addEventListener("change",i=>{let n=i.currentTarget,l=e.querySelector(".checklist__header .btnAdd");if("1"===n.value)addGroupingChecklist(t),l.classList.remove("d-none");else{clearGroupingChecklist(t),clearPointsChecklist(t),l.classList.add("d-none"),setChecklistPoint(t.id);let e=setPointToAgrouping(t);t.pointsObtained=e;let i=getPointsObtained();defaultChecklistArray.pointsObtained=i,fillChecklistInfo(defaultChecklistArray)}})})}function checkGroupingChoiceEvent(e,t,i){e.addEventListener("change",e=>{let n=e.currentTarget.value;showAddBtnGroupingChecklist(n,i),"1"===n?addGroupingChecklist(t):(clearGroupingChecklist(t),clearPointsChecklist(t),setChecklistPoint(t.id),t.pointsObtained=setPointToAgrouping(t),defaultChecklistArray.pointsObtained=getPointsObtained(),fillChecklistInfo(defaultChecklistArray))})}function showAddBtnGroupingChecklist(e,t){let i=t.querySelector(".checklist__header .btnAdd");"1"===e?i.classList.remove("d-none"):i.classList.add("d-none")}function eventsDoubleChoiceGrouping(e,t){[...e.querySelectorAll(".checkGroupingChoice")].forEach(i=>{i.addEventListener("change",i=>{"1"===i.currentTarget.value?(e.style.height="auto",t.groupingDoubleChoice=!0):(e.style.height="120px",t.groupingDoubleChoice=!1,clearPointsChecklist(t),fillChecklistInfo(defaultChecklistArray))})})}function clearPointsChecklist(e){verifyIfIsChecklistMaster(e),clearSubchecklistChecklist(e)}function verifyIfIsChecklistMaster(e){e.idDefaultChecklist===defaultChecklistArray.id&&(defaultChecklistArray.pointsObtained=defaultChecklistArray.pointsObtained-e.pointsObtained)}function clearSubchecklistChecklist(e){e.pointsObtained=0,e.subchecklist.forEach(e=>{setEmptyValueChecklist(e),setOptionsCheckFalse(e),e.subchecklist.length>0&&e.subchecklist.forEach(e=>{clearPointsChecklist(e)})})}function setOptionsCheckFalse(e){e.options.length>0&&e.options.forEach(e=>{e.selected=!1})}function setEmptyValueChecklist(e){e.pointsObtained=0,e.value="",e.oficialObservation=""}function eventsDoubleAddChoiceGrouping(e,t){let i=e.querySelector(".checklist__header .btnAdd");null!==i&&i.addEventListener("click",()=>{let e=getIdReference(t.idReferenceClone);if(allCloneChecklistGrouping.length>0&&-1!==e){let i=JSON.parse(JSON.stringify(allCloneChecklistGrouping[e]));idIncrement+=1,newIdCheck=idIncrement,setInfoAndPushNewChecklist(i,t),updateIncrementChecklist(t),setChecklistPoint(t.id);let n=setPointToAgrouping(t);t.pointsObtained=n,updatePointsToFather(t);let l=getPointsObtained();defaultChecklistArray.pointsObtained=l,fillChecklistInfo(defaultChecklistArray)}else addGroupingChecklist(t)})}function updatePointsToFather(e){let t=filterChecklist(defaultChecklistArray.subchecklist,e.idDefaultChecklist,{});if(null!==t){let e=setPointToAgrouping(t);t.pointsObtained=e,null!==t.idDefaultChecklist&&updatePointsToFather(t)}}function setInfoAndPushNewChecklist(e,t){e.id=idIncrement,e.id_type_checklist=0,e.duplicate=!1,e.duplicateSubchecklist=!0,e.oficialObservation="",t.subchecklist.push(e)}function eventsDoubleDeleteChoiceGrouping(e,t){let i=e.querySelector(".checklist__header .btnDelete");null!==i&&i.addEventListener("click",e=>{let i=filterChecklist(defaultChecklistArray.subchecklist,t.idDefaultChecklist,{});deleteChecklist(i,t);let n=setPointToAgrouping(i);if(i.pointsObtained=n,updateIncrementChecklist(i),setChecklistPoint(i.id),defaultChecklistArray.id!==i.idDefaultChecklist)updatePointsToFather(i);else{let e=setPointToAgrouping(i);i.pointsObtained=e}let l=getPointsObtained();defaultChecklistArray.pointsObtained=l,fillChecklistInfo(defaultChecklistArray)})}function deleteChecklist(e,t){e.subchecklist.length>1?deleteSubchecklistToFather(e,t):clearGroupingChecklist(e)}function deleteSubchecklistToFather(e,t){e.subchecklist.forEach(i=>{if(i.id===t.id){let t=findIndexToDeleteChecklist(e,i);e.subchecklist.splice(t,1)}})}function findIndexToDeleteChecklist(e,t){return e.subchecklist.findIndex(e=>{if(e.id===t.id)return!0})}function setPointToAgrouping(e){let t=0;return e.subchecklist.forEach(e=>{let i=0;7!==e.id_type_checklist&&0!==e.id_type_checklist||(e.subchecklist.forEach(e=>{i+=e.pointsObtained}),e.pointsObtained=i),t+=e.pointsObtained}),t}function getPointsAgrouping(e){let t=0,i=0;return e.subchecklist.forEach(e=>{t+=e.pointsObtained,i+=e.pointsObtained}),[t,i]}function getIdReference(e){return allCloneChecklistGrouping.findIndex(t=>{if(t.id===e)return!0})}function getPointsObtained(){let e=0;return defaultChecklistArray.subchecklist.forEach(t=>{e+=t.pointsObtained}),e}function addGroupingChecklist(e){let t=JSON.parse(JSON.stringify(e));definityGroupingCloneChecklist=definityGroupingChecklist(e),e.subchecklist=[],fillChecklistGrouping(t,e),e.idReferenceClone=definityGroupingCloneChecklist.id,t.name=t.name+" - 1",t.oficialObservation="",e.subchecklist.push(t),updateIncrementChecklist(t),setChecklistPoint(t.id),fillChecklistInfo(defaultChecklistArray,!0),ONE_ELEMENT("#checklist"+t.id).querySelector(".btnDelete").classList.remove("d-none")}function definityGroupingChecklist(e){let t=JSON.parse(JSON.stringify(e));return allCloneChecklistGrouping.push(t),t}function fillChecklistGrouping(e,t){idIncrement+=1,e.id=idIncrement,e.id_type_checklist=0,e.idDefaultChecklist=t.id,e.duplicateSubchecklist=!0,e.duplicate=!1}function clearGroupingChecklist(e){let t=e;t.subchecklist=[],t.oficialObservation="";let i=getIndexToGroupingChecklist(t);recoverySubchecklistWhenDelete(e,i),allCloneChecklistGrouping.splice(i,1),updateIncrementChecklist(e),e.subchecklist.forEach(e=>{setChecklistPoint(e.id)}),updatePointsFatherChecklist(e,e.points,!1),fillChecklistInfo(defaultChecklistArray)}function getIndexToGroupingChecklist(e){return allCloneChecklistGrouping.findIndex(t=>{if(t.id===e.idReferenceClone)return!0})}function recoverySubchecklistWhenDelete(e,t){allCloneChecklistGrouping[t].subchecklist.forEach(t=>{let i=JSON.parse(JSON.stringify(t));e.subchecklist.push(i)})}function updateIncrementChecklist(e){e.subchecklist.forEach((t,i)=>{let n=JSON.parse(JSON.stringify(t.subchecklist));changeNamesAgroupingChecklist(t,i),t.subchecklist=[],t.idDefaultChecklist=e.id,n.length>0&&setIncrementToSubchecklist(n,t)})}function changeNamesAgroupingChecklist(e,t){if(0===e.id_type_checklist&&e.duplicateSubchecklist){let i=e.name.split("-");e.name=i[0]+" - "+(t+1)}}function setIncrementToSubchecklist(e,t){e.forEach(e=>{let i=JSON.parse(JSON.stringify(e));idIncrement+=1,i.id=idIncrement,i.idDefaultChecklist=t.id,setIncrementToOptions(i),i.subchecklist.length>0&&updateIncrementChecklist(i),t.subchecklist.push(i)})}function setIncrementToOptions(e){if(e.options.length>0){let t=JSON.parse(JSON.stringify(e.options));e.options=[],t.forEach(t=>{let i=JSON.parse(JSON.stringify(t));idIncrement+=1,i.id=idIncrement,e.options.push(i)})}}function setChecklistPoint(e){let t=filterChecklist(defaultChecklistArray.subchecklist,e,{}),i=t.points,n=filterChecklist(defaultChecklistArray.subchecklist,e,{}).subchecklist,l=n.length,s=0;l>0&&(s=i/l);let c=s/i*100;0!==t.pointsObtained&&(t.pointsObtained=i),setSubchecklistPoint(n,c,s)}function setSubchecklistPoint(e,t,i){e.forEach(e=>{verifyPointsSubchecklistZero(e,i),fillInfoPointToChecklist(e,i,t),e.options.length>0&&updatePointsOptions(e.options,e.points,e),0!=e.pointsObtained&&updatePointsToOptions(e);let n=e.subchecklist.length;n>0&&repeatPointsUpdate(e,n)})}function verifyPointsSubchecklistZero(e,t){0!=e.pointsObtained&&7!==e.id_type_checklist&&0!==e.id_type_checklist&&(e.pointsObtained=t)}function fillInfoPointToChecklist(e,t,i){e.points=t,0!==e.pointsObtained&&(e.pointsObtained=t),e.percentage=i,e.correctPercentage=!0}function repeatPointsUpdate(e,t){let i=e.points/t,n=i/e.points*100;e.subchecklist.forEach(e=>{e.points=i,0!==e.pointsObtained&&(e.pointsObtained=i),e.options.length>0&&updatePointsOptions(e.options,e.points,e),0!=e.pointsObtained&&updatePointsToOptions(e),e.percentage=n,setChecklistPoint(e.id)})}function updatePointsToOptions(e){if(3===e.id_type_checklist){let t=0;e.options.forEach(e=>{e.selected&&(t+=e.points)}),e.pointsObtained=t}}function updatePointsOptions(e,t,i){let n=i.id_type_checklist,l=i.only_one_choose_points,s=i.only_one_choose,c=i.distinct_percentage,o=e.length,r=t/o,a=r/t*100;e.forEach(e=>{if(4===n)0!==e.points&&(e.points=i.points);else if(l||s||c){if(l||s)e.points=t;else if(c){let i=e.percentage/100*t;e.points=i,e.percentage=e.percentage,e.correctPercentage=!0}}else e.points=r,e.percentage=a,e.correctPercentage=!0})}function filterChecklist(e,t,i){let n=i;return t!==defaultChecklistArray.id?e.forEach(e=>{e.id===t?n=e:e.subchecklist!=[]&&(n=filterChecklist(e.subchecklist,t,n))}):n=null,n}function filterDefaultChecklistLastId(e,t=0){let i=t;return e.forEach(e=>{e.id>i&&(i=e.id),e.subchecklist.length>0&&(i=filterDefaultChecklistLastId(e.subchecklist,i))}),i}function verifyEmptyClient(){return""===clientId&&(ONE_ELEMENT(".alert-header").classList.remove("d-none"),ONE_ELEMENT(".alert-header").querySelector(".alert").innerHTML="Selecione um cliente",!0)}function verifyEmptyDefaultChecklist(){return 0===defaultChecklistArray.length&&(ONE_ELEMENT(".alert-header").classlist.remove("d-none"),ONE_ELEMENT(".alert-header").querySelector(".alert").innerHTML="Selecione uma checklist padrão",!0)}ONE_ELEMENT("#btnFinish").addEventListener("click",()=>{verifyEmptyClient()||verifyEmptyDefaultChecklist()?window.scrollTo(0,0):(ONE_ELEMENT("#checklistArray").value=JSON.stringify(defaultChecklistArray),ONE_ELEMENT("#formChecklistAdd").submit())}),ONE_ELEMENT("#btnSave").addEventListener("click",()=>{verifyEmptyClient()||verifyEmptyDefaultChecklist()?window.scrollTo(0,0):(ONE_ELEMENT("#idChecklist").value=defaultChecklistArray.id,ONE_ELEMENT("#checklistArrayJson").value=JSON.stringify(defaultChecklistArray),ONE_ELEMENT("#groupingArrayJson").value=JSON.stringify(allCloneChecklistGrouping),ONE_ELEMENT("#checklist_name").value=defaultChecklistArray.name,ONE_ELEMENT("#lastIdIncrement").value=idIncrement,ONE_ELEMENT("#formChecklistAddJson").submit())});