var clientId="",defaultChecklistArray=[],typeChecklistArray=["Agrupamento","Texto","Upload","Multiplas Escolhas","Dupla Escolha","Numerica","Data"];async function requestDefaultChecklist(e){const t=await fetch(BASE_URL+"/get_default_checklist_request/"+e),i=await t.json();ONE_ELEMENT("#card-loading").style.display="none",ONE_ELEMENT("#cardContentChecklist").style.display="flex",fillChecklistInfo(i)}function fillChecklistInfo(e){(defaultChecklistArray=e).pointsObtained=0,defaultChecklistArray.value="",defaultChecklistArray.oficialObservation="";let t=ONE_ELEMENT("#cardContentChecklist");t.querySelector("#contentChecklist").innerHTML="",t.querySelector(".defaultChecklist__name").innerHTML="Nome Checklist: "+defaultChecklistArray.name,t.querySelector(".defaultChecklist__points").innerHTML="Pontuação Total: "+defaultChecklistArray.points.toFixed(2),t.querySelector(".defaultChecklist__possiblePoints").innerHTML="Pontuação Obtida: "+defaultChecklistArray.pointsObtained.toFixed(2),t.querySelector(".defaultChecklist__observation").innerHTML="Observação : \n        "+(""!==defaultChecklistArray.observation?defaultChecklistArray.observation:"Não Informado"),fillChecklistsLayout(defaultChecklistArray.subchecklist),eventsChecklists(),updateChecklistPoint()}function updateChecklistPoint(){ONE_ELEMENT(".checklists__point").style.display="flex",ONE_ELEMENT(".checklist__pointTotal").innerHTML=defaultChecklistArray.points.toFixed(2),ONE_ELEMENT(".checklist__pointObtained").innerHTML=defaultChecklistArray.pointsObtained.toFixed(2)}function fillChecklistsLayout(e,t=null){e.forEach(e=>{if(e.value="",e.pointsObtained=0,e.oficialObservation="",null===t?ONE_ELEMENT("#contentChecklist").append(returnElementChecklist(e)):t.querySelector(".checklist__container").append(returnElementChecklist(e)),e.subchecklist.length){let t=ONE_ELEMENT("#checklist"+e.id);fillChecklistsLayout(e.subchecklist,t)}})}function returnElementChecklist(e){let t=e.id_type_checklist,i="";return i=3!==t&&4!==t?elementInputsChecklist(e,t):elementMultipleChoiceChecklist(e,t),i}[...ALL_ELEMENTS(".defaultCheckRadio")].forEach(e=>{e.addEventListener("change",e=>{let t=e.currentTarget.value;ONE_ELEMENT("#cardContentChecklist").style.display="none",LOADING_ELEMENT.style.display="flex",ONE_ELEMENT("#card-loading").append(LOADING_ELEMENT),ONE_ELEMENT("#card-loading").style.display="flex",requestDefaultChecklist(t)})}),[...ALL_ELEMENTS(".clientRadio")].forEach(e=>{e.addEventListener("change",e=>{clientId=e.currentTarget.value,ONE_ELEMENT("#idClient").value=clientId})});var checklistText=ONE_ELEMENT(".checklist"),checklistMultipleChoice=ONE_ELEMENT(".checklistMultiple"),checklistOption=ONE_ELEMENT(".checklistOption");function elementInputsChecklist(e,t){let i=checklistText.cloneNode(!0);return getOrShowInputByType(i,t),fillLayoutChecklist(i,e),i}function elementMultipleChoiceChecklist(e){let t=checklistMultipleChoice.cloneNode(!0);return fillLayoutChecklist(t,e),filllayoutOptions(e,t),t}function fillLayoutChecklist(e,t){e.style.display="flex",e.setAttribute("idchecklist",t.id),e.setAttribute("id","checklist"+t.id),0===t.id_type_checklist&&(e.querySelectorAll(".checklist__slot")[0].style.display="none"),3===t.id_type_checklist||4===t.id_type_checklist?(e.querySelector(".checklistTitleSlot").innerHTML=t.name,e.querySelector(".checklistTitleSlot").setAttribute("title",t.name)):(e.querySelector(".checklist__title").innerHTML=t.name,e.querySelector(".checklist__title").setAttribute("title",t.name));let i="";t.only_one_choose_points&&(i="(Pontuação única)*",e.querySelector(".checklistTypechecklist").style="flex:2;"),e.querySelector(".checklistTypechecklist").innerHTML=`${typeChecklistArray[t.id_type_checklist]} ${only_one_choose}`,e.querySelector(".checklistTypechecklist").setAttribute("title",""+typeChecklistArray[t.id_type_checklist]),e.querySelector(".checklistPossiblePoints").innerHTML="Pontos: "+t.points.toFixed(2),e.querySelector(".checklistPossiblePoints").setAttribute("title",t.points.toFixed(2)),e.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+t.pointsObtained.toFixed(2),e.querySelector(".checklistPoints").setAttribute("title",t.pointsObtained.toFixed(2)),""!==t.observation&&(3!==t.id_type_checklist&&4!==t.id_type_checklist?(e.querySelector(".observationIcon").style.display="block",e.querySelector(".observationIcon").setAttribute("title",t.observation)):(e.querySelector(".observationIconMultiple").style.display="block",e.querySelector(".observationIconMultiple").setAttribute("title",t.observation)))}function filllayoutOptions(e,t){e.options.forEach(i=>{let l=checklistOption.cloneNode(!0);i.pointsObtained=0,3===e.id_type_checklist?(l.querySelector(".checklistOptionCheck").style.display="flex",l.querySelector(".checklistOptionCheck").setAttribute("name","option"+e.id)):(l.querySelector(".checklistOptionRadio").style.display="flex",l.querySelector(".checklistOptionRadio").setAttribute("name","option"+e.id)),l.style.display="flex",l.setAttribute("idoption",i.id),l.querySelector(".optionName").innerHTML=i.name,l.querySelector(".checklistPoints").innerHTML="Pontos: "+i.points.toFixed(2),t.querySelector(".checklist__options").append(l)})}function getOrShowInputByType(e,t,i=!0){let l="";if(1===t?l=e.querySelector(".inputText"):2===t?l=e.querySelector(".inputFile"):5===t?l=e.querySelector(".inputNumber"):6===t&&(l=e.querySelector(".inputDate")),0!==t){if(!i)return l;l.style.display="flex"}}function eventsChecklists(){[...ALL_ELEMENTS("#contentChecklist .checklist")].forEach(e=>{let t=parseInt(e.getAttribute("idchecklist")),i=filterChecklist(defaultChecklistArray.subchecklist,t,{}),l=i.id_type_checklist;if(0!==l&&3!==l&&4!==l)eventsChecklistsTypeInputs(e,i);else if(0!==l){let t=!1;3===l&&(t=!0),eventsChecklistsMultipleOptions(e,i,t)}eventsObservationInput(e,i)})}function eventsChecklistsTypeInputs(e,t){let i=t.id_type_checklist,l=getOrShowInputByType(e,i,!1);2===i?l.addEventListener("change",i=>{let l=t.points,n=i.currentTarget.files[0];e.querySelector(".alert").classList.add("d-none"),n.size<4e7?uploadFile(n,t):(e.querySelector(".alert").classList.remove("d-none"),e.querySelector(".alert").innerHTML="O arquivo tem que ser menor que 40mb"),t.pointsObtained=l,e.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+t.pointsObtained.toFixed(2),""===t.value&&updatePointsFatherChecklist(t,l)}):l.addEventListener("input",i=>{let l=t.points,n=i.currentTarget.value,s=!0;""!==n?t.pointsObtained=l:(s=!1,t.pointsObtained=0),e.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+t.pointsObtained.toFixed(2),""===t.value&&updatePointsFatherChecklist(t,l,s),!1===s&&updatePointsFatherChecklist(t,l,s),t.value=n})}function eventsObservationInput(e,t){e.querySelector(".inputObservation").addEventListener("keyup",e=>{let i=e.currentTarget.value;t.oficialObservation=i})}async function uploadFile(e,t){let i=ONE_ELEMENT("#uploadFileForm");const l=new FormData(i);l.append("checklistFile",e);const n=await fetch(BASE_URL+"/upload_file",{method:"POST",body:l}),s=await n.json();t.value=s.fileName}function eventsChecklistsMultipleOptions(e,t,i=!0){[...e.querySelectorAll(".checklistOption")].forEach(l=>{let n=parseInt(l.getAttribute("idoption"));(!1===i?l.querySelector("input[type=radio]"):l.querySelector("input[type=checkbox]")).addEventListener("change",l=>{let s=t.options.findIndex(e=>{if(e.id===n)return!0}),c=t.options[s],o=c.points,r=t.pointsObtained;if(l.currentTarget.checked){t.pointsObtained=r+o,c.selected=!0,c.pointsObtained=o;let l=!0;0===o&&(l=!1,o=t.points),t.only_one_choose&&(t.pointsObtained=o),!1===i&&(t.pointsObtained=o,!1===l&&(t.pointsObtained=0)),updatePointsFatherChecklist(t,o,l),e.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+t.pointsObtained.toFixed(2)}else if(t.pointsObtained=r-o,c.selected=!1,!1===i&&(t.pointsObtained=o),t.only_one_choose){let i=0;t.options.forEach(e=>{e.selected&&i++}),0===i&&(t.pointsObtained=0,updatePointsFatherChecklist(t,o,!1),e.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+t.pointsObtained.toFixed(2))}else c.pointsObtained=0,updatePointsFatherChecklist(t,o,!1),e.querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+t.pointsObtained.toFixed(2)})})}function updatePointsFatherChecklist(e,t,i=!0){let l=e.idDefaultChecklist;if(l===defaultChecklistArray.id){updateLayoutChecklistMaster(updatePointsChecklistMaster(defaultChecklistArray.subchecklist,0))}else{let e=filterChecklist(defaultChecklistArray.subchecklist,l,{});null!==e&&(i&&(e.pointsObtained+=t),!1===i&&e.pointsObtained>0&&(e.pointsObtained-=t),updateLayoutChecklist(e),null!==e.idDefaultChecklist&&updatePointsFatherChecklist(e,t,i)),updateLayoutChecklistMaster(updatePointsChecklistMaster(defaultChecklistArray.subchecklist,0))}}function updatePointsChecklistMaster(e,t=0){let i=t;return e.forEach(e=>{e.idDefaultChecklist===defaultChecklistArray.id&&(i+=e.pointsObtained,e.subchecklist.length>0&&(i=updatePointsChecklistMaster(e.subchecklist,i)))}),i}function updateLayoutChecklistMaster(e){defaultChecklistArray.pointsObtained=e,ONE_ELEMENT("#cardContentChecklist").querySelector(".defaultChecklist__possiblePoints").innerHTML="Pontuação Obtida: "+defaultChecklistArray.pointsObtained.toFixed(2),updateChecklistPoint()}function updateLayoutChecklist(e){ONE_ELEMENT("#checklist"+e.id).querySelector(".checklistPoints").innerHTML="Pontos Obtidos: "+e.pointsObtained.toFixed(2)}function filterChecklist(e,t,i){let l=i;return t!==defaultChecklistArray.id?e.forEach(e=>{e.id===t?l=e:e.subchecklist!=[]&&(l=filterChecklist(e.subchecklist,t,l))}):l=null,l}function verifyEmptyClient(){return""===clientId&&(ONE_ELEMENT(".alert-header").classList.remove("d-none"),ONE_ELEMENT(".alert-header").querySelector(".alert").innerHTML="Selecione um cliente",!0)}function verifyEmptyDefaultChecklist(){return 0===defaultChecklistArray.length&&(ONE_ELEMENT(".alert-header").classlist.remove("d-none"),ONE_ELEMENT(".alert-header").querySelector(".alert").innerHTML="Selecione uma checklist padrão",!0)}ONE_ELEMENT("#btnSave").addEventListener("click",()=>{verifyEmptyClient()||verifyEmptyClient()?window.scrollTo(0,0):(ONE_ELEMENT("#checklistArray").value=JSON.stringify(defaultChecklistArray),ONE_ELEMENT("#formChecklistAdd").submit())});